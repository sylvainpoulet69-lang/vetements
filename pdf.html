<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>Bon de commande</title>
  <style>
    *{ box-sizing:border-box }
    body{ font-family: Arial, sans-serif; font-size:12px; color:#111; margin:24px }
    .hdr{ display:flex; justify-content:space-between; align-items:center; padding-bottom:10px; border-bottom:2px solid #111 }
    .brand{ font-weight:800; font-size:18px; line-height:1.1 }
    .meta{ font-size:12px; color:#444; text-align:right }
    .row{ margin-top:12px }
    .client{ font-size:13px }
    table{ width:100%; border-collapse:collapse; margin-top:10px }
    th,td{ border:1px solid #ccc; padding:6px; vertical-align:middle }
    th{ background:#f5f5f5; text-align:left; font-weight:700 }
    td.right{ text-align:right; white-space:nowrap }
    .thumb{ width:52px; height:52px; object-fit:cover; border-radius:6px }
    .tot{ margin-top:10px; font-weight:800; text-align:right; font-size:14px }
    .muted{ color:#666; font-size:11px; margin-top:6px }
  </style>
</head>
<body>
  <? var o = order; ?>  <!-- ✅ on récupère l'objet passé par Code.gs -->

  <div class="hdr">
    <div class="brand">Les Acacias<br><span style="font-weight:600;">Bon de commande</span></div>
    <div class="meta">
      N° <?= order_id ?><br>
      <?= Utilities.formatDate(new Date(), 'Europe/Paris', 'yyyy-MM-dd HH:mm') ?>
    </div>
  </div>

  <div class="row client">
    <b>Client :</b> <?= o.customer.name ?>
    <? if (o.customer.phone) { ?> · <b>Tél. :</b> <?= o.customer.phone ?><? } ?>
  </div>

  <table>
    <thead>
      <tr>
        <th>Photo</th>
        <th>Article</th>
        <th>Couleur</th>
        <th>Taille</th>
        <th>Genre</th>
        <th>Logo</th>
        <th>Flocage</th>
        <th class="right">Qté</th>
        <th class="right">PU</th>
        <th class="right">Total</th>
      </tr>
    </thead>
    <tbody>
      <? var total = 0;
         (o.items||[]).forEach(function(it){
           var pu = Number(it.price)||0;
           var q  = Number(it.qty)||1;
           var lt = pu*q; total += lt; ?>
      <tr>
        <td><img class="thumb" src="<?= it.image_url || 'https://via.placeholder.com/60?text=%20' ?>"></td>
        <td><?= it.title ?></td>
        <td><?= it.color  || '' ?></td>
        <td><?= it.size   || '' ?></td>
        <td><?= it.gender || '' ?></td>
        <td><?= it.logo   || '' ?></td>
        <td><?= it.flocage_text || '' ?></td>
        <td class="right"><?= q ?></td>
        <td class="right"><?= pu.toFixed(2).replace('.',',') ?>€</td>
        <td class="right"><?= lt.toFixed(2).replace('.',',') ?>€</td>
      </tr>
      <? }); ?>
    </tbody>
  </table>

  <div class="tot">Total : <?= (Number(o.total)||total).toFixed(2).replace('.',',') ?>€</div>

  <div class="muted">
    • Logo (Tennis/Padel) et flocage inclus selon la sélection.<br>
    • Merci de vérifier tailles, quantités et orthographe du flocage avant production.
  </div>
</body>
</html>
